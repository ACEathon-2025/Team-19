<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GovAlert | Report Civic Issues</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        'primary-blue': '#1c7ed6', 'primary-accent': '#79B8F3',
                        'success-green': '#40c057', 'danger-red': '#fa5252',
                        'dark-bg': '#1a1a2e', 'dark-card': '#27293d',
                        'dark-hover': '#323447', 'secondary-gray': '#4a4e69',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1a1a2e; color: #f0f0f0; }
        .tab-content, .auth-page { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-link.active { border-bottom: 2px solid #1c7ed6; color: #79B8F3; }
        input, textarea, select { background-color: #323447; color: #f0f0f0; border: 1px solid #4a4e69; }
        input::placeholder { color: #6b7280; }
        input[type="file"]::file-selector-button { background-color: #1c7ed6; color: white; }
        @keyframes glowing-border {
            0% { box-shadow: 0 0 5px rgba(121, 184, 243, 0.4); }
            50% { box-shadow: 0 0 20px rgba(121, 184, 243, 0.8); }
            100% { box-shadow: 0 0 5px rgba(121, 184, 243, 0.4); }
        }
        .hero-glow { animation: glowing-border 3s infinite alternate; }
        #map { height: 60vh; min-height: 400px; width: 100%; border-radius: 0.5rem; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- App Container -->
    <div id="app-container" class="flex-grow">
        <!-- ====================================================== -->
        <!-- ==          LOGGED-IN VIEW (MAIN APP)               == -->
        <!-- ====================================================== -->
        <div id="main-app" class="hidden">
            <header class="bg-dark-card shadow-2xl sticky top-0 z-10 border-b border-primary-blue/50">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                    <!-- UPDATED: Logo is now a SPA link -->
                    <a href="#home" class="flex items-center space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>
                        <h1 class="text-xl md:text-2xl font-extrabold text-primary-accent">GovAlert</h1>
                    </a>
                    <nav class="hidden sm:flex space-x-6 text-sm">
                        <button id="tab-home" class="nav-link font-semibold">Home</button>
                        <button id="tab-report" class="nav-link font-semibold">Submit a Report</button>
                        <button id="tab-dashboard" class="nav-link font-semibold">Public Dashboard</button>
                    </nav>
                    <div id="user-info" class="flex items-center space-x-4">
                        <span id="user-name" class="text-sm text-gray-300"></span>
                        <button id="logout-btn" class="text-sm font-semibold bg-danger-red text-white py-1 px-3 rounded-md hover:bg-red-600 transition">Logout</button>
                    </div>
                </div>
            </header>
            <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 w-full">
                <!-- RESTORED: Full Home Page UI -->
                <section id="home" class="tab-content space-y-12">
                    <div class="bg-dark-card p-8 rounded-xl shadow-2xl text-center">
                        <div class="max-w-4xl mx-auto py-12 lg:py-20 border border-primary-accent/50 rounded-2xl hero-glow">
                            <h2 class="text-4xl md:text-6xl font-extrabold mb-4 text-white tracking-tight">Your City. Your Voice.</h2>
                            <p class="text-lg md:text-2xl mb-8 text-primary-accent font-light">Report issues instantly and track their resolution.</p>
                            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                                <button onclick="window.location.hash = '#report'" class="bg-success-green text-white text-lg font-bold py-3 px-8 rounded-full shadow-lg hover:bg-green-600 transition transform hover:scale-105">Start a New Report</button>
                                <button onclick="window.location.hash = '#dashboard'" class="bg-primary-blue text-white text-lg font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-600 transition transform hover:scale-105">View Live Dashboard</button>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- RESTORED: Full Report Form UI -->
                <section id="report" class="tab-content hidden">
                    <div class="max-w-2xl mx-auto bg-dark-card p-8 rounded-xl shadow-2xl">
                         <h2 class="text-3xl font-bold text-white mb-2">Report a Civic Problem</h2>
                         <p class="text-gray-400 mb-8">Fill out the details below to submit your report.</p>
                         <form id="report-form" class="space-y-6">
                            <div>
                                <label for="report-title" class="block text-sm font-medium text-primary-accent mb-1">Issue Title</label>
                                <input type="text" id="report-title" required class="w-full p-3 rounded-lg" placeholder="e.g., Large Pothole on Main St">
                            </div>
                            <div>
                                <label for="report-description" class="block text-sm font-medium text-primary-accent mb-1">Description</label>
                                <textarea id="report-description" rows="4" required class="w-full p-3 rounded-lg" placeholder="Describe the issue in detail..."></textarea>
                            </div>
                            <button type="submit" class="w-full bg-primary-blue text-white font-bold py-3 rounded-lg hover:bg-blue-600 transition">Submit Report</button>
                        </form>
                    </div>
                </section>
                <!-- RESTORED: Full Dashboard UI -->
                <section id="dashboard" class="tab-content hidden">
                    <h2 class="text-3xl font-bold mb-6 text-primary-accent">Public Problem Dashboard</h2>
                    <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                        <div class="lg:col-span-1 bg-dark-card p-6 rounded-xl shadow-2xl mb-6 lg:mb-0 h-fit">
                            <h3 class="text-xl font-semibold mb-4 text-white">Filter Reports</h3>
                            <!-- Filter form elements go here -->
                        </div>
                        <div class="lg:col-span-3">
                            <div id="map" class="bg-dark-hover rounded-lg shadow-inner flex items-center justify-center">
                                <p class="text-gray-400">Google Map Area</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- ====================================================== -->
        <!-- ==             LOGGED-OUT VIEW (AUTH)               == -->
        <!-- ====================================================== -->
        <div id="auth-view">
             <header class="bg-dark-card shadow-lg py-4">
                <div class="max-w-5xl mx-auto px-4 flex justify-between items-center">
                    <!-- UPDATED: Logo is now a SPA link -->
                     <a href="#login" class="flex items-center space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>
                        <h1 class="text-2xl font-extrabold text-primary-accent">GovAlert</h1>
                    </a>
                    <div id="auth-nav-links" class="text-sm"></div>
                </div>
            </header>

            <main class="mt-12 sm:mt-16">
                <!-- Login Page -->
                <div id="login-page" class="auth-page hidden"><div class="max-w-md mx-auto bg-dark-card p-8 rounded-xl shadow-2xl"><h2 class="text-3xl font-bold text-center text-white mb-2">Welcome Back</h2><p class="text-center text-gray-400 mb-8">Log in to report and track issues.</p><form id="login-form" class="space-y-6"><div><label for="login-email" class="block text-sm font-medium text-primary-accent mb-1">Email Address</label><input type="email" id="login-email" required class="w-full p-3 rounded-lg" placeholder="you@example.com"></div><div><label for="login-password" class="block text-sm font-medium text-primary-accent mb-1">Password</label><input type="password" id="login-password" required class="w-full p-3 rounded-lg" placeholder="••••••••"></div><div id="login-error" class="text-danger-red text-sm hidden"></div><button type="submit" class="w-full bg-primary-blue text-white font-bold py-3 rounded-lg hover:bg-blue-600 transition">Login</button></form></div></div>
                <!-- Signup Page -->
                <div id="signup-page" class="auth-page hidden"><div class="max-w-md mx-auto bg-dark-card p-8 rounded-xl shadow-2xl"><h2 class="text-3xl font-bold text-center text-white mb-2">Create an Account</h2><p class="text-center text-gray-400 mb-8">Join to make your voice heard.</p><form id="signup-form" class="space-y-6"><div><label for="signup-name" class="block text-sm font-medium text-primary-accent mb-1">Full Name</label><input type="text" id="signup-name" required class="w-full p-3 rounded-lg" placeholder="John Doe"></div><div><label for="signup-email" class="block text-sm font-medium text-primary-accent mb-1">Email Address</label><input type="email" id="signup-email" required class="w-full p-3 rounded-lg" placeholder="you@example.com"></div><div><label for="signup-password" class="block text-sm font-medium text-primary-accent mb-1">Password</label><input type="password" id="signup-password" required class="w-full p-3 rounded-lg" placeholder="Minimum 6 characters"></div><div id="signup-error" class="text-danger-red text-sm hidden"></div><button type="submit" class="w-full bg-success-green text-white font-bold py-3 rounded-lg hover:bg-green-600 transition">Create Account</button></form></div></div>
                <!-- Admin Login Page -->
                <div id="admin-login-page" class="auth-page hidden"><div class="max-w-md mx-auto bg-dark-card border-t-4 border-danger-red p-8 rounded-xl shadow-2xl"><h2 class="text-3xl font-bold text-center text-white mb-2">Admin Portal</h2><p class="text-center text-gray-400 mb-8">Enter administrator credentials.</p><form id="admin-login-form" class="space-y-6"><div><label for="admin-email" class="block text-sm font-medium text-primary-accent mb-1">Admin Email</label><input type="email" id="admin-email" required class="w-full p-3 rounded-lg" placeholder="admin@govealert.gov"></div><div><label for="admin-password" class="block text-sm font-medium text-primary-accent mb-1">Password</label><input type="password" id="admin-password" required class="w-full p-3 rounded-lg" placeholder="••••••••"></div><div id="admin-login-error" class="text-danger-red text-sm hidden"></div><button type="submit" class="w-full bg-danger-red text-white font-bold py-3 rounded-lg hover:bg-red-600 transition">Access Portal</button></form><div class="text-center mt-6"><button type="button" onclick="window.location.hash = '#login'" class="text-sm text-primary-accent hover:underline font-semibold">&larr; Back to Resident Login</button></div></div></div>
            </main>
        </div>
    </div>

    <footer class="bg-dark-bg text-gray-400 p-4 text-center mt-auto border-t border-secondary-gray/30">
        <!-- RESTORED: Footer link is a button -->
        <div class="flex flex-col items-center space-y-2">
            <p class="text-sm">&copy; 2025 GovAlert. All Rights Reserved.</p>
            <button onclick="window.location.hash = '#admin-login'" class="bg-secondary-gray text-gray-200 text-xs font-semibold py-1 px-3 rounded-md hover:bg-dark-hover transition duration-300">Admin Portal</button>
        </div>
    </footer>

<script>
// The JavaScript remains the same as the previous version and is fully compatible.
document.addEventListener('DOMContentLoaded', () => {
    const API_BASE_URL = 'http://localhost:5000/api';
    let state = { user: null, token: null };

    const mainApp = document.getElementById('main-app');
    const authView = document.getElementById('auth-view');
    const allAuthPages = document.querySelectorAll('.auth-page');
    const allTabContents = document.querySelectorAll('.tab-content');
    const tabButtons = document.querySelectorAll('.nav-link');
    const authNavLinks = document.getElementById('auth-nav-links');

    const router = () => {
        const hash = window.location.hash || (state.token ? '#home' : '#login');
        
        allAuthPages.forEach(p => p.classList.add('hidden'));
        
        if (state.token) {
            mainApp.classList.remove('hidden');
            authView.classList.add('hidden');
            const targetTabId = hash.substring(1) || 'home';
            showTab(targetTabId);
        } else {
            mainApp.classList.add('hidden');
            authView.classList.remove('hidden');
            const pageId = `${hash.substring(1)}-page`;
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                updateAuthNav(hash);
            } else {
                document.getElementById('login-page').classList.remove('hidden');
                updateAuthNav('#login');
            }
        }
    };
    
    const showTab = (tabId) => {
        allTabContents.forEach(tab => tab.classList.add('hidden'));
        document.getElementById(tabId)?.classList.remove('hidden');
        tabButtons.forEach(btn => btn.classList.remove('active'));
        document.getElementById(`tab-${tabId}`)?.classList.add('active');
        window.location.hash = tabId;
    };

    const updateAuthNav = (currentHash) => {
        if (currentHash === '#login') authNavLinks.innerHTML = `Don't have an account? <a href="#signup" class="font-semibold text-primary-accent hover:underline">Sign Up</a>`;
        else if (currentHash === '#signup') authNavLinks.innerHTML = `Already have an account? <a href="#login" class="font-semibold text-primary-accent hover:underline">Log In</a>`;
        else authNavLinks.innerHTML = ``;
    };
    
    const updateUIForLogin = () => {
        document.getElementById('user-name').textContent = `Welcome, ${state.user.name}`;
        router();
    };
    
    const handleLogin = async (email, password, errorElementId) => {
        const errorEl = document.getElementById(errorElementId);
        errorEl.classList.add('hidden');
        try {
            const res = await fetch(`${API_BASE_URL}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.message);
            return data;
        } catch (error) {
            errorEl.textContent = error.message;
            errorEl.classList.remove('hidden');
            return null;
        }
    };
    
    const handleSignup = async (name, email, password) => {
        const errorEl = document.getElementById('signup-error');
        errorEl.classList.add('hidden');
        try {
            const res = await fetch(`${API_BASE_URL}/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, password })
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.message);
            state.user = data; state.token = data.token;
            localStorage.setItem('govealert_token', data.token);
            localStorage.setItem('govealert_user', JSON.stringify(data));
            updateUIForLogin();
        } catch (error) {
            errorEl.textContent = error.message;
            errorEl.classList.remove('hidden');
        }
    };
    
    const handleLogout = () => {
        state.user = null; state.token = null;
        localStorage.removeItem('govealert_token');
        localStorage.removeItem('govealert_user');
        window.location.hash = '#login';
        router();
    };

    const checkInitialAuthState = () => {
        const token = localStorage.getItem('govealert_token');
        const user = JSON.parse(localStorage.getItem('govealert_user'));
        if (token && user) {
            state.token = token;
            state.user = user;
        }
    };

    window.addEventListener('hashchange', router);
    tabButtons.forEach(button => button.addEventListener('click', () => showTab(button.id.replace('tab-', ''))));
    document.getElementById('logout-btn').addEventListener('click', handleLogout);

    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = await handleLogin(e.target.elements['login-email'].value, e.target.elements['login-password'].value, 'login-error');
        if (data) {
            state.user = data; state.token = data.token;
            localStorage.setItem('govealert_token', data.token);
            localStorage.setItem('govealert_user', JSON.stringify(data));
            updateUIForLogin();
        }
    });
    
    document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = await handleLogin(e.target.elements['admin-email'].value, e.target.elements['admin-password'].value, 'admin-login-error');
        if (data) {
            if (data.role !== 'Admin' && data.role !== 'Official') {
                 document.getElementById('admin-login-error').textContent = "Access denied. Not an admin/official account.";
                 document.getElementById('admin-login-error').classList.remove('hidden');
                 return;
            }
            state.user = data; state.token = data.token;
            localStorage.setItem('govealert_token', data.token);
            localStorage.setItem('govealert_user', JSON.stringify(data));
            updateUIForLogin();
        }
    });

    document.getElementById('signup-form').addEventListener('submit', (e) => {
        e.preventDefault();
        handleSignup(e.target.elements['signup-name'].value, e.target.elements['signup-email'].value, e.target.elements['signup-password'].value);
    });

    checkInitialAuthState();
    router();
});
</script>
</body>
</html>
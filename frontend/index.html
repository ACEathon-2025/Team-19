<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GovAlert | Report Civic Issues</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind for Dark Mode and custom colors
        tailwind.config = {
            darkMode: 'class', // Enable dark mode based on the 'dark' class on the body
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // Core colors
                        'primary-blue': '#1c7ed6',   // Bright blue for main action/header
                        'primary-accent': '#79B8F3', // Light blue accent for text/focus in dark mode
                        'success-green': '#40c057',
                        'danger-red': '#fa5252',
                        // Dark Mode Palette
                        'dark-bg': '#1a1a2e',      // Main background
                        'dark-card': '#27293d',    // Card background
                        'dark-hover': '#323447',   // Hover background
                        'secondary-gray': '#4a4e69', // Input/secondary elements
                    }
                }
            }
        }
    </script>
    <!-- Bootstrap CSS inclusion (for compliance, though Tailwind is primarily used for styling) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* Custom CSS for dark mode, animations, and map container */
        body {
            /* Default dark background */
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* dark-bg */
            color: #f0f0f0; /* light text */
            transition: background-color 0.3s ease, color 0.3s ease; /* smooth mode transition */
        }
        
        /* Map Container */
        #map {
            height: 400px;
            width: 100%;
            border-radius: 0.5rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4); /* Enhanced dark mode shadow */
        }
        
        /* Style for the mock map - Darker/Deeper gradient */
        .mock-map {
            background: linear-gradient(135deg, #27293d 0%, #4a4e69 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #ccc;
            text-shadow: 1px 1px 3px #000;
            position: relative;
            height: 100%;
        }
        .mock-pin {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #fa5252;
            border-radius: 50%;
            border: 3px solid #f0f0f0;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Animation for section content fade-in */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content {
            animation: fadeIn 0.4s ease-out;
        }
        
        /* Home page specific animation */
        @keyframes glowing-border {
            0% { box-shadow: 0 0 5px rgba(121, 184, 243, 0.4); }
            50% { box-shadow: 0 0 20px rgba(121, 184, 243, 0.8); }
            100% { box-shadow: 0 0 5px rgba(121, 184, 243, 0.4); }
        }
        .hero-glow {
            animation: glowing-border 3s infinite alternate;
        }


        /* Responsive adjustments */
        @media (min-width: 1024px) {
            #map {
                height: 600px;
            }
        }
        
        /* Styling for the new integrated navigation links */
        .nav-link {
            padding: 0.5rem 0.25rem;
        }

        .nav-link.active {
            border-bottom: 2px solid #1c7ed6; /* primary-blue underline */
            color: #79B8F3; /* primary-accent text color */
        }
        
        /* Style for interactive form elements in dark mode */
        input[type="text"], textarea, select {
            background-color: #323447; /* dark-hover */
            color: #f0f0f0;
            border: 1px solid #4a4e69;
        }
        input[type="file"]::file-selector-button {
             background-color: #1c7ed6;
             color: white;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- UPDATED: Integrated Sticky Header and Navigation -->
    <header class="bg-dark-card shadow-2xl sticky top-0 z-10 border-b border-primary-blue/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            
            <!-- Logo and Title -->
            <div class="flex items-center space-x-3 transition-transform duration-300 hover:scale-[1.02]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                <h1 class="text-xl md:text-2xl font-extrabold text-primary-accent tracking-tight">
                    GovAlert
                </h1>
            </div>

            <!-- Navigation Links (Integrated Tabs) -->
            <nav class="hidden sm:flex space-x-6 text-sm">
                <button id="tab-home" onclick="showTab('home')" class="nav-link font-semibold transition duration-300 ease-in-out text-gray-300 hover:text-white">
                    Home
                </button>
                <button id="tab-report" onclick="showTab('report')" class="nav-link font-semibold transition duration-300 ease-in-out text-gray-300 hover:text-white">
                    Submit a Report
                </button>
                <button id="tab-dashboard" onclick="showTab('dashboard')" class="nav-link font-semibold transition duration-300 ease-in-out text-gray-300 hover:text-white">
                    Public Dashboard
                </button>
            </nav>
            
            <!-- Mobile Menu Indicator (Simplified) -->
            <div class="sm:hidden text-gray-400 text-xs">Menu on Desktop</div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- 0. Home Page (New Default) -->
        <section id="home" class="tab-content space-y-12">
            
            <!-- Hero Section -->
            <div class="bg-dark-card p-8 rounded-xl shadow-2xl text-center">
                <div class="max-w-4xl mx-auto py-12 lg:py-20 border border-primary-accent/50 rounded-2xl hero-glow transition duration-500">
                    <h2 class="text-5xl md:text-6xl font-extrabold mb-4 text-white tracking-tight">
                        Your City. Your Voice.
                    </h2>
                    <p class="text-xl md:text-2xl mb-8 text-primary-accent font-light">
                        Report civic issues instantly and track their resolution in real-time.
                    </p>
                    
                    <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                        <button onclick="showTab('report')" class="bg-success-green text-white text-lg font-bold py-3 px-8 rounded-full shadow-lg hover:bg-green-600 transition duration-300 ease-in-out transform hover:scale-105">
                            Start a New Report
                        </button>
                        <button onclick="showTab('dashboard')" class="bg-primary-blue text-white text-lg font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-600 transition duration-300 ease-in-out transform hover:scale-105">
                            View Live Dashboard
                        </button>
                    </div>
                </div>
            </div>

            <!-- New Section: How It Works -->
            <div class="bg-dark-card p-8 rounded-xl shadow-2xl">
                <h3 class="text-3xl font-bold mb-8 text-center text-primary-accent border-b border-secondary-gray/50 pb-3">How GovAlert Works</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Step 1 -->
                    <div class="flex flex-col items-center text-center p-4 bg-dark-hover rounded-xl transition duration-300 hover:ring-2 hover:ring-primary-blue/70">
                        <span class="text-4xl text-primary-blue font-extrabold mb-2">1.</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-primary-blue mb-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                        <h4 class="text-xl font-bold mb-2 text-white">Locate & Describe</h4>
                        <p class="text-gray-400 text-sm">Pinpoint the issue location and provide a detailed description of the problem.</p>
                    </div>
                    <!-- Step 2 -->
                    <div class="flex flex-col items-center text-center p-4 bg-dark-hover rounded-xl transition duration-300 hover:ring-2 hover:ring-primary-blue/70">
                        <span class="text-4xl text-primary-blue font-extrabold mb-2">2.</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-primary-blue mb-4" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3.32 4.15c-.17.21-.49.31-.79.22s-.52-.38-.52-.64V13c0-.38-.2-.73-.52-.92l-1.87-1.11c-.26-.15-.42-.43-.42-.74s.16-.59.42-.74l1.87-1.11c.32-.19.52-.54.52-.92V7c0-.26.23-.49.49-.64s.62-.06.79.22l3.32 4.15c.21.27.34.54.34.81s-.13.54-.34.81z"/></svg>
                        <h4 class="text-xl font-bold mb-2 text-white">Attach Proof</h4>
                        <p class="text-gray-400 text-sm">Upload a required photo of the damage, graffiti, or issue for verification.</p>
                    </div>
                    <!-- Step 3 -->
                    <div class="flex flex-col items-center text-center p-4 bg-dark-hover rounded-xl transition duration-300 hover:ring-2 hover:ring-primary-blue/70">
                        <span class="text-4xl text-primary-blue font-extrabold mb-2">3.</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-primary-blue mb-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                        <h4 class="text-xl font-bold mb-2 text-white">Watch it Happen</h4>
                        <p class="text-gray-400 text-sm">Track the status on the Public Dashboard until the report is fully resolved by the city.</p>
                    </div>
                </div>
            </div>

            <!-- New Section: Key Impact Metrics -->
            <div class="bg-primary-blue/20 p-8 rounded-xl shadow-2xl">
                <h3 class="text-3xl font-bold mb-8 text-center text-white">Our Community Impact</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                    <div class="p-6 bg-dark-card rounded-xl shadow-lg border-b-4 border-primary-blue">
                        <p class="text-5xl font-extrabold text-primary-accent">4,500+</p>
                        <p class="text-sm text-gray-300 mt-2">Total Reports Submitted</p>
                    </div>
                    <div class="p-6 bg-dark-card rounded-xl shadow-lg border-b-4 border-success-green">
                        <p class="text-5xl font-extrabold text-success-green">185</p>
                        <p class="text-sm text-gray-300 mt-2">Issues Resolved This Month</p>
                    </div>
                    <div class="p-6 bg-dark-card rounded-xl shadow-lg border-b-4 border-primary-accent">
                        <p class="text-5xl font-extrabold text-primary-accent">7 Days</p>
                        <p class="text-sm text-gray-300 mt-2">Average Resolution Time</p>
                    </div>
                </div>
            </div>

            <!-- Original Feature Blocks (Now below Impact) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                <!-- Feature 1 -->
                <div class="p-6 bg-dark-hover rounded-xl shadow-lg transition duration-300 hover:bg-secondary-gray/50 hover:shadow-xl">
                    <h4 class="text-2xl font-bold mb-2 text-primary-accent flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                        Easy Submission
                    </h4>
                    <p class="text-gray-300 text-sm">Submit reports for potholes, graffiti, or outages in under a minute with location and photo proof.</p>
                </div>
                <!-- Feature 2 -->
                <div class="p-6 bg-dark-hover rounded-xl shadow-lg transition duration-300 hover:bg-secondary-gray/50 hover:shadow-xl">
                    <h4 class="text-2xl font-bold mb-2 text-primary-accent flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1s-1 .45-1 1v7c0 .55.45 1 1 1zm4 2c-.01.66-.46 1.25-1 1.58V20c0 .55-.45 1-1 1h-4c-.55 0-1-.45-1-1v-4.42c-.54-.33-.99-.92-1-1.58H4v-2h16v2h-4z"/></svg>
                        Public Visibility
                    </h4>
                    <p class="text-gray-300 text-sm">View all current and resolved issues on the interactive dashboard for full transparency.</p>
                </div>
                <!-- Feature 3 -->
                <div class="p-6 bg-dark-hover rounded-xl shadow-lg transition duration-300 hover:bg-secondary-gray/50 hover:shadow-xl">
                    <h4 class="text-2xl font-bold mb-2 text-primary-accent flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm0 12H4V8h16v10zm-6-4h-4v-2h4v2z"/></svg>
                        Status Tracking
                    </h4>
                    <p class="text-gray-300 text-sm">Monitor the status (Pending, Investigating, Resolved) of your report from submission to completion.</p>
                </div>
            </div>
            
            <!-- New Section: Testimonial/Callout -->
            <div class="p-8 bg-dark-hover rounded-xl shadow-2xl border-l-8 border-success-green text-center">
                <p class="text-xl italic text-gray-200 mb-4">
                    "Since using GovAlert, our neighborhood association has seen streetlights fixed and potholes repaired three times faster than before. It truly makes a difference."
                </p>
                <p class="font-semibold text-primary-accent">— Jane Doe, Concerned Citizen, Metropolis</p>
            </div>
            
        </section>


        <!-- 1. Report Submission Form -->
        <section id="report" class="tab-content hidden bg-dark-card p-6 rounded-xl shadow-2xl">
            <h2 class="text-2xl font-bold mb-4 text-primary-accent">Report a Civic Problem</h2>
            <p class="text-gray-400 mb-6">Use this form to quickly report issues like potholes, non-working streetlights, or illegal dumping.</p>

            <form id="report-form" class="space-y-6">
                <!-- Problem Description -->
                <div>
                    <label for="description" class="block text-sm font-medium text-primary-accent mb-1">Problem Description (Be specific)</label>
                    <textarea id="description" rows="4" required class="w-full p-3 border rounded-lg focus:ring-primary-accent focus:border-primary-accent transition duration-150 resize-y placeholder:text-gray-500" placeholder="Describe the issue, e.g., 'Large pothole at the intersection of Main St and Oak Ave.'"></textarea>
                </div>

                <!-- Location Information (Mock Fields) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="address" class="block text-sm font-medium text-primary-accent mb-1">Street Address / Landmark</label>
                        <input type="text" id="address" required class="w-full p-3 border rounded-lg focus:ring-primary-accent focus:border-primary-accent transition duration-150 placeholder:text-gray-500" placeholder="e.g., 123 Main St or Central Park entrance">
                    </div>
                    <div>
                        <label for="city" class="block text-sm font-medium text-primary-accent mb-1">City / Neighborhood</label>
                        <input type="text" id="city" required class="w-full p-3 border rounded-lg focus:ring-primary-accent focus:border-primary-accent transition duration-150 placeholder:text-gray-500" placeholder="e.g., Downtown, Metropolis">
                    </div>
                    <div class="md:col-span-2">
                        <label for="location-note" class="block text-sm font-medium text-primary-accent mb-1">Pinpoint Location (Optional)</label>
                        <button type="button" class="w-full bg-secondary-gray text-white p-3 rounded-lg hover:bg-dark-hover transition duration-300 border border-secondary-gray hover:border-primary-accent/50">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                            Use Current GPS Location (Mock)
                        </button>
                    </div>
                </div>

                <!-- Proof (Image/File Upload) -->
                <div>
                    <label for="proof" class="block text-sm font-medium text-primary-accent mb-1">Upload Photo Proof (Required)</label>
                    <input type="file" id="proof" accept="image/*" required class="block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-blue file:text-white hover:file:bg-blue-600 transition duration-150">
                    <p class="mt-1 text-xs text-gray-500">Max file size 5MB. Accepted formats: JPG, PNG.</p>
                </div>

                <!-- Submission Status Message Box -->
                <div id="submission-message" class="hidden p-4 rounded-lg text-sm border-2 font-medium" role="alert"></div>

                <!-- Submit Button -->
                <div class="pt-4">
                    <button type="submit" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-medium text-white bg-success-green hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-success-green/50 transition duration-300 ease-in-out transform hover:scale-[1.01]">
                        Submit Report
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-2" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </div>
            </form>
        </section>

        <!-- 2. Public Dashboard & Map -->
        <section id="dashboard" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-6 text-primary-accent">Public Problem Dashboard</h2>
            <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                <!-- Filtering Sidebar (Responsive: full width on mobile, 1/4 on desktop) -->
                <div class="lg:col-span-1 bg-dark-card p-6 rounded-xl shadow-2xl mb-6 lg:mb-0 h-fit">
                    <h3 class="text-xl font-semibold mb-4 border-b border-gray-600 pb-2 text-white">Filter Reports</h3>
                    <div class="space-y-4">
                        <!-- Filter 1: Problem Type -->
                        <div>
                            <label for="filter-type" class="block text-sm font-medium text-primary-accent mb-1">Problem Type</label>
                            <select id="filter-type" onchange="filterReports()" class="w-full p-2 border rounded-lg focus:ring-primary-accent focus:border-primary-accent transition duration-150">
                                <option value="All">All Types</option>
                                <option value="Pothole">Potholes / Road Damage</option>
                                <option value="Light">Streetlight Outage</option>
                                <option value="Waste">Illegal Dumping / Waste</option>
                                <option value="Traffic">Traffic Signal Malfunction</option>
                                <option value="Other">Other Issues</option>
                            </select>
                        </div>
                        <!-- Filter 2: Status -->
                        <div>
                            <label for="filter-status" class="block text-sm font-medium text-primary-accent mb-1">Status</label>
                            <select id="filter-status" onchange="filterReports()" class="w-full p-2 border rounded-lg focus:ring-primary-accent focus:border-primary-accent transition duration-150">
                                <option value="All">All Statuses</option>
                                <option value="Pending">Pending Review</option>
                                <option value="Investigating">Investigating</option>
                                <option value="Resolved">Resolved</option>
                            </select>
                        </div>
                        <!-- Filter 3: Geographic Field (City) -->
                        <div>
                            <label for="filter-city" class="block text-sm font-medium text-primary-accent mb-1">City / Region</label>
                            <select id="filter-city" onchange="filterReports()" class="w-full p-2 border rounded-lg focus:ring-primary-accent focus:border-primary-accent transition duration-150">
                                <option value="All">All Cities</option>
                                <option value="Metropolis">Metropolis</option>
                                <option value="Gotham">Gotham Heights</option>
                                <option value="Central">Central District</option>
                            </select>
                        </div>
                        <button onclick="clearFilters()" class="w-full bg-secondary-gray text-white p-2 rounded-lg hover:bg-dark-hover transition duration-300 mt-2 hover:shadow-md">Clear Filters</button>
                    </div>
                </div>

                <!-- Map and Problem List -->
                <div class="lg:col-span-3 space-y-6">
                    <!-- Interactive Google Map (Mocked) -->
                    <div id="map" class="mock-map">
                        <p class="text-2xl font-extrabold p-4 rounded-lg bg-black/50 backdrop-blur-sm">Mock Interactive Map Area</p>
                        <div class="mock-pin" style="top: 25%; left: 30%;"></div>
                        <div class="mock-pin" style="top: 65%; left: 70%; animation-delay: 0.5s;"></div>
                        <div class="mock-pin" style="top: 40%; left: 50%; animation-delay: 1s;"></div>
                    </div>

                    <!-- Reported Problems List -->
                    <div class="bg-dark-card p-6 rounded-xl shadow-2xl">
                        <h3 class="text-xl font-semibold mb-4 text-white">Latest Reports</h3>
                        <div id="reports-list" class="space-y-3">
                            <!-- Reports will be injected here by JavaScript -->
                            <p class="text-center text-gray-500" id="empty-list-message">No reports match the current filters.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-900 text-gray-400 p-4 text-center mt-8 shadow-inner">
        <p class="text-sm">&copy; 2025 GovAlert. All rights reserved. (Dark Mode Demo)</p>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // Mock data structure for reported problems
        let reports = [
            { id: 1, description: "Large pothole spanning two lanes near the post office.", address: "1428 Elm Street", city: "Metropolis", type: "Pothole", status: "Pending", proof: "pothole.jpg" },
            { id: 2, description: "Streetlight completely out, corner is pitch black.", address: "734 Wayne Ave", city: "Gotham", type: "Light", status: "Investigating", proof: "light_out.png" },
            { id: 3, description: "Construction debris dumped in the green belt area.", address: "Northside Park Entrance", city: "Central", type: "Waste", status: "Resolved", proof: "dumping.jpeg" },
            { id: 4, description: "Red light stuck permanently on Main Street.", address: "Main & 5th Intersection", city: "Metropolis", type: "Traffic", status: "Pending", proof: "traffic_stuck.webp" },
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // Set 'home' as the default active tab
            showTab('home');
            // Initial reports rendering is now handled solely when the dashboard tab is activated,
            // which prevents "elements not found" errors on initial load.
        });

        // ----------------------------------------------------------------------
        // Tab Switching Logic
        // ----------------------------------------------------------------------
        const showTab = (tabId) => {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            // Show the target tab content
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.remove('hidden');
            } else {
                console.error(`Tab content element not found for ID: ${tabId}`);
                return;
            }

            // Deactivate all navigation links
            document.querySelectorAll('.nav-link').forEach(button => {
                // Remove active classes (for nav-link)
                button.classList.remove('active', 'text-primary-accent', 'border-b-2', 'border-primary-blue');
                // Set default inactive state (for nav-link)
                button.classList.add('text-gray-300', 'hover:text-white');
            });
            
            // Activate the current tab link
            const activeNavLink = document.getElementById('tab-' + tabId);
            if (activeNavLink) {
                // Add active state styles: lighter text, blue underline/accent
                activeNavLink.classList.add('active', 'text-primary-accent', 'border-b-2', 'border-primary-blue');
                activeNavLink.classList.remove('text-gray-300', 'hover:text-white');
            }

            // Re-render reports whenever dashboard tab is opened to ensure it's fresh
            // This is where the rendering should be triggered to avoid initial load errors.
            if (tabId === 'dashboard') {
                filterReports();
            }
        };

        // ----------------------------------------------------------------------
        // Report Submission Logic
        // ----------------------------------------------------------------------
        document.getElementById('report-form')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            const description = form.elements['description'].value;
            const address = form.elements['address'].value;
            const city = form.elements['city'].value;
            const proof = form.elements['proof'].files[0];

            if (!proof) {
                showMessage("Please upload proof of the problem.", 'danger');
                return;
            }

            // Mock submission process
            const newReport = {
                id: reports.length + 1,
                description: description,
                address: address,
                city: city,
                type: 'Other', // Simplified type assignment for new reports
                status: 'Pending',
                proof: proof.name // Storing file name as mock proof
            };

            reports.unshift(newReport); // Add new report to the start
            form.reset();
            showMessage("✅ Report submitted successfully! Tracking ID: " + newReport.id, 'success');
            
            // Update dashboard display
            // Only update if the dashboard is currently visible or will be viewed next.
            // filterReports(); // Keep this optional unless we are switching to dashboard right after submission
        });

        /**
         * Shows a message in the submission message box.
         * @param {string} text - The message text.
         * @param {'success' | 'danger'} type - The type of message.
         */
        function showMessage(text, type) {
            const messageBox = document.getElementById('submission-message');
            if (!messageBox) return; // Defensive check
            
            messageBox.textContent = text;
            messageBox.classList.remove('hidden', 'bg-green-100', 'border-green-400', 'text-green-700', 'bg-red-100', 'border-red-400', 'text-red-700', 'bg-green-900', 'border-green-600', 'text-green-300', 'bg-red-900', 'border-red-600', 'text-red-300');
            
            messageBox.classList.add('transition', 'duration-300'); // Add transition for smooth color change

            if (type === 'success') {
                // Dark mode success colors
                messageBox.classList.add('bg-green-900', 'border-success-green', 'text-green-300');
            } else if (type === 'danger') {
                // Dark mode danger colors
                messageBox.classList.add('bg-red-900', 'border-danger-red', 'text-red-300');
            }

            // Show and hide after 5 seconds
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        // ----------------------------------------------------------------------
        // Dashboard and Filtering Logic
        // ----------------------------------------------------------------------

        /**
         * Renders the list of reports based on the provided array.
         * @param {Array} filteredReports - The array of reports to display.
         */
        function renderReports(filteredReports) {
            const listContainer = document.getElementById('reports-list');
            const emptyMessage = document.getElementById('empty-list-message');

            // Defensive check is now okay as this function is only called when the dashboard is visible
            if (!listContainer || !emptyMessage) {
                console.error("Dashboard elements not found: reports-list or empty-list-message.");
                return; 
            }
            
            listContainer.innerHTML = '';

            if (filteredReports.length === 0) {
                emptyMessage.classList.remove('hidden');
                return;
            }

            emptyMessage.classList.add('hidden');

            filteredReports.forEach(report => {
                const statusColor = report.status === 'Resolved' ? 'bg-success-green' :
                                    report.status === 'Investigating' ? 'bg-primary-blue' :
                                    'bg-danger-red';
                
                // Add hover and focus effects for interactivity
                const reportHtml = `
                    <div class="report-item flex items-start p-4 bg-dark-hover rounded-lg shadow-sm transition duration-300 hover:shadow-lg hover:ring-2 hover:ring-primary-accent/50 cursor-pointer">
                        <div class="flex-shrink-0 mr-3 mt-1 transition-transform duration-300 group-hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-accent" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                        </div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold text-white">${report.type} in ${report.city}</span>
                                <span class="text-xs font-bold px-3 py-1 rounded-full ${statusColor} text-white">${report.status}</span>
                            </div>
                            <p class="text-sm text-gray-400 italic">Report #${report.id}</p>
                            <p class="text-sm text-gray-300 mt-1">${report.description}</p>
                            <p class="text-xs text-primary-accent/70 mt-1">Location: ${report.address}</p>
                        </div>
                    </div>
                `;
                listContainer.insertAdjacentHTML('beforeend', reportHtml);
            });
        }

        /**
         * Filters the mock report data based on current selections and re-renders the list.
         */
        function filterReports() {
            const type = document.getElementById('filter-type')?.value;
            const status = document.getElementById('filter-status')?.value;
            const city = document.getElementById('filter-city')?.value;
            
            // Defensive check for filter elements
            if (!type || !status || !city) {
                // If filter elements are not found, we are likely not in the dashboard view, so we skip filtering
                return;
            }

            const filtered = reports.filter(report => {
                const typeMatch = type === 'All' || report.type === type;
                const statusMatch = status === 'All' || report.status === status;
                const cityMatch = city === 'All' || report.city === city;
                return typeMatch && statusMatch && cityMatch;
            }).sort((a, b) => b.id - a.id); // Sort by descending ID (newest first)

            renderReports(filtered);
        }
        
        /**
         * Clears all filter selections and resets the report list.
         */
        function clearFilters() {
            document.getElementById('filter-type').value = 'All';
            document.getElementById('filter-status').value = 'All';
            document.getElementById('filter-city').value = 'All';
            filterReports();
        }

        // ----------------------------------------------------------------------
        // Mock Google Maps Initialization
        // ----------------------------------------------------------------------
        function initMap() {
            console.log("Mock Map initialized. Replace this with actual Google Maps API code.");
        }
    </script>
</body>
</html>